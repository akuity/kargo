üöÄ The Kargo team is excited to bring you v1.7.0, which expands Kargo's integration capabilities with new webhook receivers and Promotion steps!

## ‚ö†Ô∏è Breaking Changes {#breaking-changes}

As announced in our [`v1.5.0` release notes](https://github.com/akuity/kargo/releases/tag/v1.5.0), several deprecated features have been removed in this release.

- The `spec` field has been removed from the Project CRD in favor of the [ProjectConfig CRD](https://docs.kargo.io/user-guide/how-to-guides/working-with-projects/#project-configuration).
- The `secrets` map has been removed from the [Promotion variables](https://docs.kargo.io/user-guide/reference-docs/expressions/#promotion-variables). The better performing [`secret()` function](https://docs.kargo.io/user-guide/reference-docs/expressions/#secretname) should be used instead.
- The `git-open-pr` step no longer produces output with the key `prNumber`. The same information is available in the [`pr.id` output](https://docs.kargo.io/user-guide/reference-docs/promotion-steps/git-open-pr/#output), with other information about the PR available in the `pr` object.
- The `gitRepoURL` field has been removed from a Warehouse's [container image subscription](https://docs.kargo.io/user-guide/how-to-guides/working-with-warehouses/#container-image-subscriptions). This information is now retrieved from [OCI annotations](https://docs.kargo.io/user-guide/how-to-guides/working-with-freight/#oci-image-annotations) instead of being specified directly by the user.

Other breaking changes:

- The `http` step's determination of success / failure / indeterminate (retry) is now more intuitive. It aligns with how people _thought_ it worked before, but is a change from how it actually worked. Refer to the [documentation](https://docs.kargo.io/user-guide/reference-docs/promotion-steps/http#success-and-failure-determination) for more details.
- The validation of Promotion steps referencing a PromotionTask have been made more strict. The change is non-breaking unless you have existing configuration that is invalid and you were unaware. This breakage will help you to avoid much worse surprises!

## ‚ö†Ô∏è New Deprecations {#new-deprecations}

The Warehouse's container image subscription's `semverConstraint` field is now deprecated and scheduled for removal in the v1.9.0 release. Use the new, more generic `constraint` field. It will accept a semantic version constraint string if the image selection strategy is `SemVer` (the default).

## ‚ú® New Features {#new-features}

### ü™ù Webhook Receivers {#webhook-receivers}

The webhook receivers introduced in v1.6.0 have been enhanced in this release to improve their performance. From now on, webhook receivers will not unnecessarily refresh a Warehouse (triggering artifact discovery) if the tag, version or references extracted from the payload would be ignored by the Warehouse's subscription.

Additionally, support for the following webhook receivers has been added:

- [Artifactory](https://docs.kargo.io/user-guide/reference-docs/webhook-receivers/artifactory/)
- [Azure](https://docs.kargo.io/user-guide/reference-docs/webhook-receivers/azure/) (Azure DevOps and ACR)
- [Gitea](https://docs.kargo.io/user-guide/reference-docs/webhook-receivers/gitea/)

‚ö†Ô∏è __Webhook support remains in beta, meaning the Kargo maintainers caution that your mileage may vary and that breaking changes to this feature in upcoming releases remain a possibility.__

### ü™ú New and Updated Promotion Steps {#new-and-updated-promotion-steps}

To allow Promotions to work with more types of artifacts, two new Promotion steps have been added in this release:

- [`oci-download`](https://docs.kargo.io/user-guide/reference-docs/promotion-steps/oci-download/): With this step, you can download an OCI artifact from a remote registry and use it in your Promotion. This is for example useful to [download a Helm chart from a remote OCI registry and use it with the `helm-template` step](https://docs.kargo.io/user-guide/reference-docs/promotion-steps/oci-download/#downloading-and-rendering-helm-charts).
- [`http-download`](https://docs.kargo.io/user-guide/reference-docs/promotion-steps/http-download/): This step allows you to download any file from a remote HTTP server and use it in your Promotion.

Additionally, the following improvements have been made to existing Promotion steps:

- [`helm-template`](https://docs.kargo.io/user-guide/reference-docs/promotion-steps/helm-template/) now supports configuring an `outLayout` to control the output directory structure of rendered Helm charts. By setting it to `flat`, the rendered chart will be output in a flat directory structure instead of Helm's default nested structure.
- [`helm-update-chart`](https://docs.kargo.io/user-guide/reference-docs/promotion-steps/helm-update-chart/) does not require the `charts` field to be set anymore. If it is not set, the chart dependencies will be updated according to the SemVer constraints specified in the `Chart.yaml` file.

### üñ•Ô∏è UI Improvements {#ui-improvements}

- Cluster-level secrets can now be managed through the UI.
- [Cluster-level webhook receivers](https://docs.kargo.io/operator-guide/cluster-configuration/#triggering-artifact-discovery-using-webhooks) can now be managed through the UI.
- A pipeline view "minimap" has been added, making it easier to navigate large pipelines.
- The image history section has been redesigned to provide a more intuitive and cleaner view.
- The step alias defined for a Promotion step is now displayed more prominently in the UI, making it easier to identify steps in a Promotion.

### üõ†Ô∏è Other Notable Changes {#other-notable-changes}

- When a discovered container image has a `org.opencontainers.image.created` or `org.label-schema.build-date` annotation set, Kargo will now use that date as the image's creation date instead of the creation time set on the image itself. This resolves issues where layer caching could cause newer images to appear older than they actually are, leading to inconsistent image selection behavior. (Thanks to @bmbferreira for this contribution!)
- Git commit discovery performance has been significantly improved, particularly for Warehouses that need to scan deep into repository history to find matching commits. (Thank you, @boh-dan, for this contribution!)
- Project creation and deletion can now be self-serviced by users through a new `kargo-project-creator` ServiceAccount that automatically grants Project creators admin permissions on their created Projects. This enables users to create, manage, and delete their own Projects without requiring manual admin intervention for permission setup.
- A controller for a specific shard can now also be configured to handle all objects that have no shard assigned to them, effectively configuring it as the "default" controller. This is controlled by a new `controller.isDefault` configuration option that allows a single controller instance to process both shard-specific resources and unassigned resources simultaneously, providing more flexibility in multi-controller deployments.
- A new `kargo-promoter` role is now automatically created in each Project namespace, enabling a "release manager" pattern where users can control the timing of releases without having the ability to modify pipelines. The promoter role grants permissions to promote Stages and create Promotions while restricting access to create, update, or delete core pipeline resources like Stages and Warehouses.
- SSO with Okta now works without Dex as a middleman through improved OIDC compatibility, including proper state parameter handling in PKCE flows, configurable scope management that no longer forces the `offline_access` scope, and tolerance for trailing slashes in OIDC issuer URLs. (Thanks to @02strich for this contribution!)

## üôè New Contributors {#new-contributors}

As always, we would love to thank all first-time community contributors for their efforts! This release includes contributions from:

- @02strich
- @boh-dan
- @bmbferreira

**Full Changelog**: https://github.com/akuity/kargo/compare/v1.6.2...v1.7.0
