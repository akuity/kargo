syntax = "proto3";

package akuity.io.kargo.service.v1alpha1;

import "google/protobuf/timestamp.proto";
import "api/v1alpha1/generated.proto";
import "k8s.io/api/core/v1/generated.proto";
import "api/stubs/rollouts/v1alpha1/generated.proto";
import "api/rbac/v1alpha1/generated.proto";
import "google/protobuf/any.proto";

option go_package = "github.com/akuity/kargo/api/service/v1alpha1;svcv1alpha1";

// RawFormat specifies the format for raw resource representation.
enum RawFormat {
  // RAW_FORMAT_UNSPECIFIED indicates no specific format is requested.
  RAW_FORMAT_UNSPECIFIED = 0;
  // RAW_FORMAT_JSON requests JSON format for raw resources.
  RAW_FORMAT_JSON = 1;
  // RAW_FORMAT_YAML requests YAML format for raw resources.
  RAW_FORMAT_YAML = 2;
}

// KargoService provides the primary API for interacting with Kargo resources.
// It offers comprehensive functionality for managing continuous delivery pipelines,
// including stages, promotions, freight, warehouses, credentials, and related resources.
service KargoService {
  // GetVersionInfo returns version information for the Kargo server.
  rpc GetVersionInfo(GetVersionInfoRequest) returns (GetVersionInfoResponse);
  // GetConfig retrieves the server configuration including ArgoCD shard information.
  rpc GetConfig(GetConfigRequest) returns (GetConfigResponse);
  // GetPublicConfig returns publicly accessible configuration including OIDC settings.
  rpc GetPublicConfig(GetPublicConfigRequest) returns (GetPublicConfigResponse);

  // AdminLogin authenticates an admin user and returns an access token.
  rpc AdminLogin(AdminLoginRequest) returns (AdminLoginResponse);

  /* Kargo-related resources management API */
  // TODO(devholic): Add ApplyResource API
  // rpc ApplyResource(ApplyResourceRequest) returns (ApplyResourceRequest);
  // CreateResource creates new Kubernetes resources from provided manifests.
  rpc CreateResource(CreateResourceRequest) returns (CreateResourceResponse);
  // CreateOrUpdateResource creates or updates Kubernetes resources based on provided manifests.
  rpc CreateOrUpdateResource(CreateOrUpdateResourceRequest) returns (CreateOrUpdateResourceResponse);
  // UpdateResource updates existing Kubernetes resources with provided manifests.
  rpc UpdateResource(UpdateResourceRequest) returns (UpdateResourceResponse);
  // DeleteResource deletes Kubernetes resources specified in the provided manifests.
  rpc DeleteResource(DeleteResourceRequest) returns (DeleteResourceResponse);
  // RefreshResource triggers a refresh of the specified Kargo resource.
  rpc RefreshResource(RefreshResourceRequest) returns (RefreshResourceResponse);
  /* Stage APIs */

  // ListStages retrieves all stages within a project.
  rpc ListStages(ListStagesRequest) returns (ListStagesResponse);
  // ListImages returns available images and their usage across stages.
  rpc ListImages(ListImagesRequest) returns (ListImagesResponse);
  // GetStage retrieves details of a specific stage.
  rpc GetStage(GetStageRequest) returns (GetStageResponse);
  // WatchStages provides a streaming interface to monitor stage changes.
  rpc WatchStages(WatchStagesRequest) returns (stream WatchStagesResponse);
  // DeleteStage removes a stage from the system.
  rpc DeleteStage(DeleteStageRequest) returns (DeleteStageResponse);

  /* ClusterConfig APIs */

  // GetClusterConfig retrieves cluster-level configuration settings.
  rpc GetClusterConfig(GetClusterConfigRequest) returns (GetClusterConfigResponse);
  // DeleteClusterConfig removes cluster-level configuration.
  rpc DeleteClusterConfig(DeleteClusterConfigRequest) returns (DeleteClusterConfigResponse);
  // WatchClusterConfig provides streaming updates for cluster configuration changes.
  rpc WatchClusterConfig(WatchClusterConfigRequest) returns (stream WatchClusterConfigResponse);

  /* Promotion APIs */

  // ListPromotions retrieves all promotions, optionally filtered by stage.
  rpc ListPromotions(ListPromotionsRequest) returns (ListPromotionsResponse);
  // WatchPromotions provides streaming updates for promotion changes.
  rpc WatchPromotions(WatchPromotionsRequest) returns (stream WatchPromotionsResponse);
  // GetPromotion retrieves details of a specific promotion.
  rpc GetPromotion(GetPromotionRequest) returns (GetPromotionResponse);
  // WatchPromotion provides streaming updates for a specific promotion.
  rpc WatchPromotion(WatchPromotionRequest) returns (stream WatchPromotionResponse);
  // AbortPromotion cancels a running promotion process.
  rpc AbortPromotion(AbortPromotionRequest) returns (AbortPromotionResponse);

  /* Project APIs */

  // DeleteProject removes a project and all associated resources.
  rpc DeleteProject(DeleteProjectRequest) returns (DeleteProjectResponse);
  // GetProject retrieves details of a specific project.
  rpc GetProject(GetProjectRequest) returns (GetProjectResponse);
  // ListProjects retrieves all projects with optional filtering and pagination.
  rpc ListProjects(ListProjectsRequest) returns (ListProjectsResponse);

  /* ProjectConfig APIs */
  // GetProjectConfig retrieves project-level configuration settings.
  rpc GetProjectConfig(GetProjectConfigRequest) returns (GetProjectConfigResponse);
  // DeleteProjectConfig removes project-level configuration.
  rpc DeleteProjectConfig(DeleteProjectConfigRequest) returns (DeleteProjectConfigResponse);
  // WatchProjectConfig provides streaming updates for project configuration changes.
  rpc WatchProjectConfig(WatchProjectConfigRequest) returns (stream WatchProjectConfigResponse);

  /* Freight APIs */

  // ApproveFreight marks freight as approved for promotion to a specific stage.
  rpc ApproveFreight(ApproveFreightRequest) returns (ApproveFreightResponse);
  // DeleteFreight removes freight from the system.
  rpc DeleteFreight(DeleteFreightRequest) returns (DeleteFreightResponse);
  // GetFreight retrieves details of specific freight.
  rpc GetFreight(GetFreightRequest) returns (GetFreightResponse);
  // WatchFreight provides streaming updates for freight changes.
  rpc WatchFreight(WatchFreightRequest) returns (stream WatchFreightResponse);
  // PromoteToStage initiates a promotion of freight to a specific stage.
  rpc PromoteToStage(PromoteToStageRequest) returns (PromoteToStageResponse);
  // PromoteDownstream automatically promotes freight to downstream stages.
  rpc PromoteDownstream(PromoteDownstreamRequest) returns (PromoteDownstreamResponse);
  // QueryFreight searches for freight based on specified criteria.
  rpc QueryFreight(QueryFreightRequest) returns (QueryFreightResponse);
  // UpdateFreightAlias changes the alias associated with specific freight.
  rpc UpdateFreightAlias(UpdateFreightAliasRequest) returns (UpdateFreightAliasResponse);

  /* Verification APIs */

  // Reverify triggers re-execution of verification processes for a stage.
  rpc Reverify(ReverifyRequest) returns (ReverifyResponse);
  // AbortVerification cancels running verification processes for a stage.
  rpc AbortVerification(AbortVerificationRequest) returns (AbortVerificationResponse);

  /* Warehouse APIs */

  // ListWarehouses retrieves all warehouses within a project.
  rpc ListWarehouses(ListWarehousesRequest) returns (ListWarehousesResponse);
  // GetWarehouse retrieves details of a specific warehouse.
  rpc GetWarehouse(GetWarehouseRequest) returns (GetWarehouseResponse);
  // WatchWarehouses provides streaming updates for warehouse changes.
  rpc WatchWarehouses(WatchWarehousesRequest) returns (stream WatchWarehousesResponse);
  // DeleteWarehouse removes a warehouse from the system.
  rpc DeleteWarehouse(DeleteWarehouseRequest) returns (DeleteWarehouseResponse);

  /* Repo Credentials APIs */

  // CreateRepoCredentials creates new credentials for accessing external repositories.
  rpc CreateRepoCredentials(CreateRepoCredentialsRequest) returns (CreateRepoCredentialsResponse);
  // DeleteRepoCredentials removes repository credentials from the system.
  rpc DeleteRepoCredentials(DeleteRepoCredentialsRequest) returns (DeleteRepoCredentialsResponse);
  // GetRepoCredentials retrieves details of specific repository credentials.
  rpc GetRepoCredentials(GetRepoCredentialsRequest) returns (GetRepoCredentialsResponse);
  // ListRepoCredentials retrieves all repository credentials within a project.
  rpc ListRepoCredentials(ListRepoCredentialsRequest) returns (ListRepoCredentialsResponse);
  // UpdateRepoCredentials modifies existing repository credentials.
  rpc UpdateRepoCredentials(UpdateRepoCredentialsRequest) returns (UpdateRepoCredentialsResponse);

  /* Generic Credentials APIs */

  // ListGenericCredentials retrieves all generic credentials within a project.
  rpc ListGenericCredentials(ListGenericCredentialsRequest) returns (ListGenericCredentialsResponse);
  // CreateGenericCredentials creates new generic credentials within a project.
  rpc CreateGenericCredentials(CreateGenericCredentialsRequest) returns (CreateGenericCredentialsResponse);
  // UpdateGenericCredentials modifies existing generic credentials.
  rpc UpdateGenericCredentials(UpdateGenericCredentialsRequest) returns (UpdateGenericCredentialsResponse);
  // DeleteGenericCredentials removes generic credentials from a project.
  rpc DeleteGenericCredentials(DeleteGenericCredentialsRequest) returns (DeleteGenericCredentialsResponse);

  /* ConfigMaps APIs */

  // CreateConfigMap creates a new project-level, system-level, or shared
  // ConfigMap.
  rpc CreateConfigMap(CreateConfigMapRequest) returns (CreateConfigMapResponse);
  // DeleteConfigMap deletes a project-level, system-level, or shared ConfigMap.
  rpc DeleteConfigMap(DeleteConfigMapRequest) returns (DeleteConfigMapResponse);
  // ListConfigMaps retrieves all ConfigMaps within a project.
  rpc ListConfigMaps(ListConfigMapsRequest) returns (ListConfigMapsResponse);
  // GetConfigMap retrieves details of a specific project-level, system-level,
  // or shared ConfigMap.
  rpc GetConfigMap(GetConfigMapRequest) returns (GetConfigMapResponse);
  // UpdateConfigMap updates a project-level, system-level, or shared ConfigMap.
  rpc UpdateConfigMap(UpdateConfigMapRequest) returns (UpdateConfigMapResponse);

  /* Analysis APIs */

  // ListAnalysisTemplates retrieves all AnalysisTemplates within a project.
  rpc ListAnalysisTemplates(ListAnalysisTemplatesRequest) returns (ListAnalysisTemplatesResponse);
  // GetAnalysisTemplate retrieves details of a specific AnalysisTemplate.
  rpc GetAnalysisTemplate(GetAnalysisTemplateRequest) returns (GetAnalysisTemplateResponse);
  // DeleteAnalysisTemplate removes an AnalysisTemplate from a project.
  rpc DeleteAnalysisTemplate(DeleteAnalysisTemplateRequest) returns (DeleteAnalysisTemplateResponse);
  // ListClusterAnalysisTemplates retrieves all cluster-scoped AnalysisTemplates.
  rpc ListClusterAnalysisTemplates(ListClusterAnalysisTemplatesRequest) returns (ListClusterAnalysisTemplatesResponse);
  // GetClusterAnalysisTemplate retrieves details of a specific cluster-scoped AnalysisTemplate.
  rpc GetClusterAnalysisTemplate(GetClusterAnalysisTemplateRequest) returns (GetClusterAnalysisTemplateResponse);
  // DeleteClusterAnalysisTemplate removes a cluster-scoped AnalysisTemplate.
  rpc DeleteClusterAnalysisTemplate(DeleteClusterAnalysisTemplateRequest) returns (DeleteClusterAnalysisTemplateResponse);
  // GetAnalysisRun retrieves details of a specific AnalysisRun.
  rpc GetAnalysisRun(GetAnalysisRunRequest) returns (GetAnalysisRunResponse);
  // GetAnalysisRunLogs streams logs from an AnalysisRun.
  rpc GetAnalysisRunLogs(GetAnalysisRunLogsRequest) returns (stream GetAnalysisRunLogsResponse);

  /* Event APIs */

  // ListProjectEvents retrieves events associated with a project.
  rpc ListProjectEvents(ListProjectEventsRequest) returns (ListProjectEventsResponse);

  /* Promotion Task APIs */

  // ListPromotionTasks retrieves all PromotionTasks within a project.
  rpc ListPromotionTasks(ListPromotionTasksRequest) returns (ListPromotionTasksResponse);
  // ListClusterPromotionTasks retrieves all cluster-scoped PromotionTasks.
  rpc ListClusterPromotionTasks(ListClusterPromotionTasksRequest) returns (ListClusterPromotionTasksResponse);
  // GetPromotionTask retrieves details of a specific PromotionTask.
  rpc GetPromotionTask(GetPromotionTaskRequest) returns (GetPromotionTaskResponse);
  // GetClusterPromotionTask retrieves details of a specific cluster-scoped PromotionTask.
  rpc GetClusterPromotionTask(GetClusterPromotionTaskRequest) returns (GetClusterPromotionTaskResponse);

  /* Kargo Role APIs */

  // Note: A "Kargo Role" is a virtual resource -- an abstraction over a trio of
  // Kubernetes ServiceAccount, Role, and RoleBinding resources. It's one
  // virtual resource that says who can do what with what.

  // CreateRole creates a new Kargo Role virtual resource by creating its
  // underlying Kubernetes resources.
  rpc CreateRole(CreateRoleRequest) returns (CreateRoleResponse);
  // DeleteRole deletes a Kargo Role virtual resource by deleting its underlying
  // Kubernetes resources.
  rpc DeleteRole(DeleteRoleRequest) returns (DeleteRoleResponse);
  // GetRole retrieves details of a Kargo Role virtual resource or its
  // underlying Kubernetes resources.
  rpc GetRole(GetRoleRequest) returns (GetRoleResponse);
  // Grant assigns permissions to a Kargo Role virtual resource or binds users
  // having specific OIDC claims to a Kargo Role virtual resource by updating
  // its underlying Kubernetes resources.
  rpc Grant(GrantRequest) returns (GrantResponse);
  // ListRoles retrieves details of all Kargo Role virtual resources or their
  // underlying Kubernetes resources.
  rpc ListRoles(ListRolesRequest) returns (ListRolesResponse);
  // Revoke removes permissions from a Kargo Role virtual resource or unbinds
  // users having specific OIDC claims from a Kargo Role virtual resource by
  // updating its underlying Kubernetes resources.
  rpc Revoke(RevokeRequest) returns (RevokeResponse);
  // UpdateRole modifies an existing Kargo Role virtual resource by updating its
  // underlying Kubernetes resources.
  rpc UpdateRole(UpdateRoleRequest) returns (UpdateRoleResponse);

  /* Kargo API Tokens */

  // CreateAPIToken generates and returns a new bearer token associated with a
  // Kargo Role virtual resource.
  rpc CreateAPIToken(CreateAPITokenRequest) returns (CreateAPITokenResponse);
  // DeleteToken deletes a bearer token associated with a Kargo Role virtual
  // resource.
  rpc DeleteAPIToken(DeleteAPITokenRequest) returns (DeleteAPITokenResponse);
  // GetAPIToken retrieves details of a specific bearer token associated with a
  // Kargo Role virtual resource.
  rpc GetAPIToken(GetAPITokenRequest) returns (GetAPITokenResponse);
  // ListAPITokens lists bearer tokens associated with with a specified Kargo
  // Role virtual resource.
  rpc ListAPITokens(ListAPITokensRequest) returns (ListAPITokensResponse);

}

/* Version and Configuration Messages */

// ComponentVersions contains version information for different Kargo components.
message ComponentVersions {
  // server contains version information for the Kargo server.
  optional VersionInfo server = 1;
  // cli contains version information for the Kargo CLI.
  optional VersionInfo cli = 2;
}

// VersionInfo contains detailed version and build information for a Kargo component.
message VersionInfo {
  // version is the semantic version string.
  string version = 1;
  // git_commit is the Git commit hash used for the build.
  string git_commit = 2;
  // git_tree_dirty indicates whether the Git working tree was dirty during build.
  bool git_tree_dirty = 3;
  // build_time is the timestamp when the build was created.
  google.protobuf.Timestamp build_time = 4;
  // go_version is the Go version used for the build.
  string go_version = 5;
  // compiler is the compiler used for the build.
  string compiler = 6;
  // platform is the target platform for the build.
  string platform = 7;
}

// GetVersionInfoRequest is the request message for retrieving version information.
message GetVersionInfoRequest {}

// GetVersionInfoResponse contains the server's version information.
message GetVersionInfoResponse {
  // version_info contains detailed version and build information.
  VersionInfo version_info = 1;
}

// GetConfigRequest is the request message for retrieving server configuration.
message GetConfigRequest {}

// ArgoCDShard represents configuration for a specific ArgoCD shard.
message ArgoCDShard {
  // url is the base URL of the ArgoCD server.
  string url = 1;
  // namespace is the Kubernetes namespace where ArgoCD is installed.
  string namespace = 2;
}

// GetConfigResponse contains server configuration information.
message GetConfigResponse {
  // argocd_shards maps shard names to their ArgoCD configuration.
  map<string, ArgoCDShard> argocd_shards = 1;
  // secret_management_enabled indicates if secret management features are available.
  bool secret_management_enabled = 2;
  // system_resources_namespace is the namespace used for "cluster-scoped" system secrets.
  string system_resources_namespace = 3;
  // has_analysis_run_logs_url_template indicates if an analysis run logs URL template is configured.
  bool has_analysis_run_logs_url_template = 4;
}

// GetPublicConfigRequest is the request message for retrieving public configuration.
message GetPublicConfigRequest {}

// GetPublicConfigResponse contains publicly accessible configuration settings.
message GetPublicConfigResponse {
  // oidc_config contains OpenID Connect configuration for authentication.
  OIDCConfig oidc_config = 1;
  // admin_account_enabled indicates if admin account authentication is available.
  bool admin_account_enabled = 2;
  // skip_auth indicates if authentication should be bypassed.
  bool skip_auth = 3;
}

// OIDCConfig contains OpenID Connect configuration for authentication.
message OIDCConfig {
  // issuer_url is the OIDC provider's issuer URL.
  string issuer_url = 1;
  // client_id is the OIDC client identifier for web applications.
  string client_id = 2;
  // scopes are the OIDC scopes to request during authentication.
  repeated string scopes = 3;
  // cli_client_id is the OIDC client identifier for CLI applications.
  string cli_client_id = 4;
}

// AdminLoginRequest contains credentials for admin authentication.
message AdminLoginRequest {
  // password is the admin password.
  string password = 1;
}

// AdminLoginResponse contains the authentication token for admin access.
message AdminLoginResponse {
  // id_token is the JWT token for authenticated admin access.
  string id_token = 1;
}

/* Resource Management Messages */

// CreateResourceRequest contains Kubernetes resource manifests to be created.
message CreateResourceRequest {
  // manifest contains the raw Kubernetes resource manifests in YAML or JSON format.
  bytes manifest = 1;
}

// CreateResourceResult represents the result of attempting to create a single resource.
message CreateResourceResult {
  oneof result {
    // created_resource_manifest contains the successfully created resource manifest.
    bytes created_resource_manifest = 1;
    // error contains the error message if resource creation failed.
    string error = 2;
  }
}

// CreateResourceResponse contains the results of creating multiple resources.
message CreateResourceResponse {
  // results contains the outcome for each resource creation attempt.
  repeated CreateResourceResult results = 1;
}

// CreateOrUpdateResourceRequest contains Kubernetes resource manifests to be created or updated.
message CreateOrUpdateResourceRequest {
  // manifest contains the raw Kubernetes resource manifests in YAML or JSON format.
  bytes manifest = 1;
}

// CreateOrUpdateResourceResult represents the result of attempting to create or update a single resource.
message CreateOrUpdateResourceResult {
  oneof result {
    // created_resource_manifest contains the newly created resource manifest.
    bytes created_resource_manifest = 1;
    // updated_resource_manifest contains the updated existing resource manifest.
    bytes updated_resource_manifest = 2;
    // error contains the error message if the operation failed.
    string error = 3;
  }
}

// CreateOrUpdateResourceResponse contains the results of creating or updating multiple resources.
message CreateOrUpdateResourceResponse {
  // results contains the outcome for each resource create or update attempt.
  repeated CreateOrUpdateResourceResult results = 1;
}

// UpdateResourceRequest contains Kubernetes resource manifests to be updated.
message UpdateResourceRequest {
  // manifest contains the raw Kubernetes resource manifests in YAML or JSON format.
  bytes manifest = 1;
}

// UpdateResourceResult represents the result of attempting to update a single resource.
message UpdateResourceResult {
  oneof result {
    // updated_resource_manifest contains the successfully updated resource manifest.
    bytes updated_resource_manifest = 1;
    // error contains the error message if resource update failed.
    string error = 2;
  }
}

// UpdateResourceResponse contains the results of updating multiple resources.
message UpdateResourceResponse {
  // results contains the outcome for each resource update attempt.
  repeated UpdateResourceResult results = 1;
}

// DeleteResourceRequest contains Kubernetes resource manifests to be deleted.
message DeleteResourceRequest {
  // manifest contains the raw Kubernetes resource manifests in YAML or JSON format.
  bytes manifest = 1;
}

// DeleteResourceResult represents the result of attempting to delete a single resource.
message DeleteResourceResult {
  oneof result {
    // deleted_resource_manifest contains the successfully deleted resource manifest.
    bytes deleted_resource_manifest = 1;
    // error contains the error message if resource deletion failed.
    string error = 2;
  }
}

// DeleteResourceResponse contains the results of deleting multiple resources.
message DeleteResourceResponse {
  // results contains the outcome for each resource deletion attempt.
  repeated DeleteResourceResult results = 1;
}

/* Stage Messages */

// ListStagesRequest is the request for listing stages within a project.
message ListStagesRequest {
  // project is the name of the project whose stages should be listed.
  string project = 1;
}

// ListStagesResponse contains a list of stages within a project.
message ListStagesResponse {
  // stages is the list of Stage resources found in the project.
  repeated github.com.akuity.kargo.api.v1alpha1.Stage stages = 1;
}

// ListImagesRequest is the request for listing images and their usage across stages.
message ListImagesRequest {
  // project is the name of the project whose images should be listed.
  string project = 1;
}

// ListImagesResponse contains information about images and their usage across stages.
message ListImagesResponse {
  // images maps image repository names to their tags and stage usage information.
  map<string, TagMap> images = 2;
}

// TagMap represents the mapping of image tags to stages that have used them.
message TagMap {
  // tags maps image tag names to stages which have previously used that tag.
  map<string, ImageStageMap> tags = 1;
}

// ImageStageMap represents the mapping of stages to the order in which an image was promoted.
message ImageStageMap {
  // stages maps stage names to the order in which an image was promoted to that stage.
  map<string, int32> stages = 1;
}

// GetStageRequest is the request for retrieving details of a specific stage.
message GetStageRequest {
  // project is the name of the project containing the stage.
  string project = 1;
  // name is the name of the stage to retrieve.
  string name = 2;
  // format specifies the format for raw resource representation.
  RawFormat format = 3;
}

// GetStageResponse contains the requested stage information.
message GetStageResponse {
  oneof result {
    // stage contains the Stage resource in structured format.
    github.com.akuity.kargo.api.v1alpha1.Stage stage = 1;
    // raw contains the Stage resource in the requested raw format.
    bytes raw = 2;
  }
}

// WatchStagesRequest is the request for watching stage changes via streaming.
message WatchStagesRequest {
  // project is the name of the project whose stages should be watched.
  string project = 1;
  // name is the name of a specific stage to watch, if empty all stages in the project are watched.
  string name = 2;
}

// WatchStagesResponse contains stage change notifications.
message WatchStagesResponse {
  // stage is the Stage resource that changed.
  github.com.akuity.kargo.api.v1alpha1.Stage stage = 1;
  // type indicates the type of change (ADDED, MODIFIED, DELETED).
  string type = 2;
}

// DeleteStageRequest is the request for deleting a stage.
message DeleteStageRequest {
  // project is the name of the project containing the stage.
  string project = 1;
  // name is the name of the stage to delete.
  string name = 2;
}

// DeleteStageResponse is the response after deleting a stage.
message DeleteStageResponse {
  /* explicitly empty */
}
/* ClusterConfig Messages */

message GetClusterConfigRequest {
  RawFormat format = 1;
}

message GetClusterConfigResponse {
  oneof result {
    github.com.akuity.kargo.api.v1alpha1.ClusterConfig cluster_config = 1;
    bytes raw = 2;
  }
}

message DeleteClusterConfigRequest {
  /* explicitly empty */
}

message DeleteClusterConfigResponse {
  /* explicitly empty */
}

message WatchClusterConfigRequest {
  /* explicitly empty */
}

message WatchClusterConfigResponse {
  github.com.akuity.kargo.api.v1alpha1.ClusterConfig cluster_config = 1;
  string type = 2; // ADDED / MODIFIED / DELETED
}

/* Promotion Messages */

// ListPromotionsRequest is the request for retrieving all promotions, optionally filtered by stage.
message ListPromotionsRequest {
  // project is the name of the project whose promotions should be listed.
  string project = 1;
  // stage is an optional stage name to filter promotions by.
  optional string stage = 2;
}

// ListPromotionsResponse contains a list of promotions within a project.
message ListPromotionsResponse {
  // promotions is the list of Promotion resources found in the project.
  repeated github.com.akuity.kargo.api.v1alpha1.Promotion promotions = 1;
}

// WatchPromotionsRequest is the request for watching promotion changes via streaming.
message WatchPromotionsRequest {
  // project is the name of the project whose promotions should be watched.
  string project = 1;
  // stage is an optional stage name to filter promotions by.
  optional string stage = 2;
}

// WatchPromotionsResponse contains promotion change notifications.
message WatchPromotionsResponse {
  // promotion is the Promotion resource that changed.
  github.com.akuity.kargo.api.v1alpha1.Promotion promotion = 1;
  // type indicates the type of change (ADDED, MODIFIED, DELETED).
  string type = 2;
}

// GetPromotionRequest is the request for retrieving details of a specific promotion.
message GetPromotionRequest {
  // project is the name of the project containing the promotion.
  string project = 1;
  // name is the name of the promotion to retrieve.
  string name = 2;
  // format specifies the format for raw resource representation.
  RawFormat format = 3;
}

// GetPromotionResponse contains the requested promotion information.
message GetPromotionResponse {
  oneof result {
    // promotion contains the Promotion resource in structured format.
    github.com.akuity.kargo.api.v1alpha1.Promotion promotion = 1;
    // raw contains the Promotion resource in the requested raw format.
    bytes raw = 2;
  }
}

// WatchPromotionRequest is the request for watching a specific promotion via streaming.
message WatchPromotionRequest {
  // project is the name of the project containing the promotion.
  string project = 1;
  // name is the name of the promotion to watch.
  string name = 2;
}

// WatchPromotionResponse contains specific promotion change notifications.
message WatchPromotionResponse {
  // promotion is the Promotion resource that changed.
  github.com.akuity.kargo.api.v1alpha1.Promotion promotion = 1;
  // type indicates the type of change (ADDED, MODIFIED, DELETED).
  string type = 2;
}

// AbortPromotionRequest is the request for canceling a running promotion process.
message AbortPromotionRequest {
  // project is the name of the project containing the promotion.
  string project = 1;
  // name is the name of the promotion to abort.
  string name = 2;
}

// AbortPromotionResponse is the response after aborting a promotion.
message AbortPromotionResponse {
  /* explicitly empty */
}

/* Project Messages */

// DeleteProjectRequest is the request for deleting a project and all associated resources.
message DeleteProjectRequest {
  // name is the name of the project to delete.
  string name = 1;
}

// DeleteProjectResponse is the response after deleting a project.
message DeleteProjectResponse {
  /* explicitly empty */
}

// GetProjectRequest is the request for retrieving details of a specific project.
message GetProjectRequest {
  // name is the name of the project to retrieve.
  string name = 1;
  // format specifies the format for raw resource representation.
  RawFormat format = 2;
}

// GetProjectResponse contains the requested project information.
message GetProjectResponse {
  oneof result {
    // project contains the Project resource in structured format.
    github.com.akuity.kargo.api.v1alpha1.Project project = 1;
    // raw contains the Project resource in the requested raw format.
    bytes raw = 2;
  }
}

// ListProjectsRequest is the request for listing all projects with optional filtering and pagination.
message ListProjectsRequest {
  // page_size specifies the maximum number of projects to return per page.
  optional int32 page_size = 1;
  // page specifies which page of results to return.
  optional int32 page = 2;
  // filter specifies an optional filter expression for projects.
  optional string filter = 3;
  // ui store starred projects uids, so it needs to filter it when looking at starred projects
  repeated string uid = 4;
}

// ListProjectsResponse contains the list of projects and pagination information.
message ListProjectsResponse {
  // projects is the list of Project resources matching the request criteria.
  repeated github.com.akuity.kargo.api.v1alpha1.Project projects = 1;
  // total is the total number of projects available (across all pages).
  int32 total = 2;
}

/* ProjectConfig Messages */

// GetProjectConfigRequest is the request for retrieving project-level configuration settings.
message GetProjectConfigRequest {
  // project is the name of the project to retrieve configuration for.
  string project = 1;
  // format specifies the desired response format (structured object or raw YAML).
  RawFormat format = 2;
}

// GetProjectConfigResponse contains the requested project configuration.
message GetProjectConfigResponse {
  oneof result {
    // project_config is the structured ProjectConfig object.
    github.com.akuity.kargo.api.v1alpha1.ProjectConfig project_config = 1;
    // raw is the raw YAML representation of the project configuration.
    bytes raw = 2;
  }
}

// DeleteProjectConfigRequest is the request for removing project-level configuration.
message DeleteProjectConfigRequest {
  // project is the name of the project to delete configuration for.
  string project = 1;
}

// DeleteProjectConfigResponse is the response after deleting project configuration.
message DeleteProjectConfigResponse {
  /* explicitly empty */
}

// WatchProjectConfigRequest is the request for streaming project configuration changes.
message WatchProjectConfigRequest {
  // project is the name of the project to watch for configuration changes.
  string project = 1;
}

// WatchProjectConfigResponse provides streaming updates for project configuration changes.
message WatchProjectConfigResponse {
  // project_config is the updated ProjectConfig object.
  github.com.akuity.kargo.api.v1alpha1.ProjectConfig project_config = 1;
  // type indicates the type of change (ADDED / MODIFIED / DELETED).
  string type = 2;
}

/* Freight Messages */

// ApproveFreightRequest is the request for approving freight for promotion to a stage.
message ApproveFreightRequest {
  // project is the name of the project containing the freight.
  string project = 1;
  // name is the name of the freight to approve.
  string name = 2;
  // alias is the alias of the freight to approve.
  string alias = 3;
  // stage is the name of the stage for which to approve the freight.
  string stage = 4;
}

// ApproveFreightResponse is the response after approving freight.
message ApproveFreightResponse {
  /* explicitly empty */
}

// DeleteFreightRequest is the request for deleting freight.
message DeleteFreightRequest {
  // project is the name of the project containing the freight.
  string project = 1;
  // name is the name of the freight to delete.
  string name = 2;
  // alias is the alias of the freight to delete.
  string alias = 3;
}

// DeleteFreightResponse is the response after deleting freight.
message DeleteFreightResponse {
  /* explicitly empty */
}

// GetFreightRequest is the request for retrieving details of specific freight.
message GetFreightRequest {
  // project is the name of the project containing the freight.
  string project = 1;
  // name is the name of the freight to retrieve.
  string name = 2;
  // alias is the alias of the freight to retrieve.
  string alias = 3;
  // format specifies the format for raw resource representation.
  RawFormat format = 4;
}

// GetFreightResponse contains the requested freight information.
message GetFreightResponse {
  oneof result {
    // freight contains the Freight resource in structured format.
    github.com.akuity.kargo.api.v1alpha1.Freight freight = 1;
    // raw contains the Freight resource in the requested raw format.
    bytes raw = 2;
  }
}

// WatchFreightRequest is the request for watching freight changes via streaming.
message WatchFreightRequest {
  // project is the name of the project whose freight should be watched.
  string project = 1;
}

// WatchFreightResponse contains freight change notifications.
message WatchFreightResponse {
  // freight is the Freight resource that changed.
  github.com.akuity.kargo.api.v1alpha1.Freight freight = 1;
  // type indicates the type of change (ADDED, MODIFIED, DELETED).
  string type = 2; // ADDED / MODIFIED / DELETED
}

// PromoteToStageRequest is the request for promoting freight to a specific stage.
message PromoteToStageRequest {
  // project is the name of the project containing the stage and freight.
  string project = 1;
  // stage is the name of the stage to promote freight to.
  string stage = 2;
  // freight is the name of the freight to promote.
  string freight = 3;
  // freight_alias is the alias of the freight to promote.
  string freight_alias = 4 [json_name = "freightAlias"];
}

// PromoteToStageResponse contains the promotion created for the freight promotion.
message PromoteToStageResponse {
  // promotion is the Promotion resource created for this freight promotion.
  github.com.akuity.kargo.api.v1alpha1.Promotion promotion = 1;
}

// PromoteDownstreamRequest is the request for automatically promoting freight to downstream stages.
message PromoteDownstreamRequest {
  // project is the name of the project containing the stage and freight.
  string project = 1;
  // stage is the name of the source stage from which to promote downstream.
  string stage = 2;
  // freight is the name of the freight to promote downstream.
  string freight = 3;
  // freight_alias is the alias of the freight to promote downstream.
  string freight_alias = 4 [json_name = "freightAlias"];
}

// PromoteDownstreamResponse contains the promotions created for downstream freight promotions.
message PromoteDownstreamResponse {
  // promotions are the Promotion resources created for downstream freight promotions.
  repeated github.com.akuity.kargo.api.v1alpha1.Promotion promotions = 1;
}

// QueryFreightRequest is the request for searching freight based on specified criteria.
message QueryFreightRequest {
  // project is the name of the project to search for freight.
  string project = 1;
  // stage is the name of the stage to filter freight by.
  string stage = 2;
  // group_by specifies how to group the freight results.
  string group_by = 3;
  // group specifies which group to return results for.
  string group = 4;
  // order_by specifies how to order the freight results.
  string order_by = 5;
  // reverse indicates whether to reverse the order of results.
  bool reverse = 6;
  // origins filters freight by their origins (e.g., warehouse names).
  repeated string origins = 7;
}

// QueryFreightResponse contains the grouped freight search results.
message QueryFreightResponse {
  // groups maps group names to their corresponding freight lists.
  map<string, FreightList> groups = 1;
}

// FreightList contains a list of freight resources.
message FreightList {
  // freight is the list of Freight resources.
  repeated github.com.akuity.kargo.api.v1alpha1.Freight freight = 1;
}

// UpdateFreightAliasRequest is the request for updating a freight's alias.
message UpdateFreightAliasRequest {
  // project is the name of the project containing the freight.
  string project = 1;
  // name is the name of the freight whose alias should be updated.
  string name = 2;
  // old_alias is the current alias of the freight.
  string old_alias = 3 [json_name = "oldAlias"];
  // new_alias is the new alias to assign to the freight.
  string new_alias = 4 [json_name = "newAlias"];
}

// UpdateFreightAliasResponse is the response after updating a freight's alias.
message UpdateFreightAliasResponse {
  /* explicitly empty */
}

/* Verification Messages */

// ReverifyRequest is the request for triggering re-execution of verification processes for a stage.
message ReverifyRequest {
  // project is the name of the project containing the stage.
  string project = 1;
  // stage is the name of the stage to reverify.
  string stage = 2;
}

// ReverifyResponse is the response after triggering reverification.
message ReverifyResponse {
  /* explicitly empty */
}

// AbortVerificationRequest is the request for canceling running verification processes for a stage.
message AbortVerificationRequest {
  // project is the name of the project containing the stage.
  string project = 1;
  // stage is the name of the stage whose verification should be aborted.
  string stage = 2;
}

// AbortVerificationResponse is the response after aborting verification.
message AbortVerificationResponse {
  /* explicitly empty */
}

/* Warehouse Messages */

// ListWarehousesRequest is the request for listing warehouses within a project.
message ListWarehousesRequest {
  // project is the name of the project whose warehouses should be listed.
  string project = 1;
}

// ListWarehousesResponse contains a list of warehouses within a project.
message ListWarehousesResponse {
  // warehouses is the list of Warehouse resources found in the project.
  repeated github.com.akuity.kargo.api.v1alpha1.Warehouse warehouses = 1;
}

// GetWarehouseRequest is the request for retrieving details of a specific warehouse.
message GetWarehouseRequest {
  // project is the name of the project containing the warehouse.
  string project = 1;
  // name is the name of the warehouse to retrieve.
  string name = 2;
  // format specifies the format for raw resource representation.
  RawFormat format = 3;
}

// GetWarehouseResponse contains the requested warehouse information.
message GetWarehouseResponse {
  oneof result {
    // warehouse contains the Warehouse resource in structured format.
    github.com.akuity.kargo.api.v1alpha1.Warehouse warehouse = 1;
    // raw contains the Warehouse resource in the requested raw format.
    bytes raw = 2;
  }
}

// WatchWarehousesRequest is the request for watching warehouse changes via streaming.
message WatchWarehousesRequest {
  // project is the name of the project whose warehouses should be watched.
  string project = 1;
  // name is the name of a specific warehouse to watch, if empty all warehouses in the project are watched.
  string name = 2;
}

// WatchWarehousesResponse contains warehouse change notifications.
message WatchWarehousesResponse {
  // warehouse is the Warehouse resource that changed.
  github.com.akuity.kargo.api.v1alpha1.Warehouse warehouse = 1;
  // type indicates the type of change (ADDED, MODIFIED, DELETED).
  string type = 2;
}

// DeleteWarehouseRequest is the request for deleting a warehouse.
message DeleteWarehouseRequest {
  // project is the name of the project containing the warehouse.
  string project = 1;
  // name is the name of the warehouse to delete.
  string name = 2;
}

// DeleteWarehouseResponse is the response after deleting a warehouse.
message DeleteWarehouseResponse {
  /* explicitly empty */
}

/* ConfigMap Messages */

// CreateConfigMapRequest is the request for creating a project-level,
// system-level, or shared ConfigMap.
message CreateConfigMapRequest {
  // system_level indicates whether the request is to create a system-level
  // ConfigMap instead of a project-level or shared one.
  bool system_level = 1;
  // project is the name of the project where the ConfigMap will be created. If
  // empty and system_level is false, creates the ConfigMap in the shared
  // resources namespace. This value is ignored if system_level is true.
  string project = 2;
  // name is the name of the ConfigMap to create.
  string name = 3;
  // description is a human-readable description of the ConfigMap.
  string description = 4;
  // data contains the key-value pairs that make up the ConfigMap.
  map<string, string> data = 5;
}

// CreateConfigMapResponse is the response containing the ConfigMap that was
// created.
message CreateConfigMapResponse {
  // config_map is the ConfigMap that was created.
  k8s.io.api.core.v1.ConfigMap config_map = 1;
}

// DeleteConfigMapRequest is the request for deleting a project-level,
// system-level, or shared ConfigMap.
message DeleteConfigMapRequest {
  // system_level indicates whether the request is to delete a
  // system-level ConfigMap instead of a project-level or shared one.
  bool system_level = 1;
  // project is the name of the project in which to delete a ConfigMap. If empty
  // and system_level is false, deletes a shared ConfigMap. This value is
  // ignored if system_level is true.
  string project = 2;
  // name is the name of the ConfigMap to delete.
  string name = 3;
}

// DeleteConfigMapResponse is the response returned after deleting a ConfigMap.
message DeleteConfigMapResponse {
  /* explicitly empty */
}

// ListConfigMapsRequest is the request for listing all project-level,
// system-level, or shared ConfigMaps.
message ListConfigMapsRequest {
  // system_level indicates whether the request is to list system-level
  // ConfigMaps instead of project-level or shared ones.
  bool system_level = 2;
  // project is the name of the project in which to list ConfigMaps. If empty
  // and system_level is false, lists shared ConfigMaps. This value is ignored
  // if system_level is true.
  string project = 1;
}

// ListConfigMapsResponse contains the list of ConfigMaps.
message ListConfigMapsResponse {
  // config_maps is the list of ConfigMaps.
  repeated k8s.io.api.core.v1.ConfigMap config_maps = 1;
}

// GetConfigMapRequest is the request for getting a specific project-level,
// system-level, or shared ConfigMap.
message GetConfigMapRequest {
  // system_level indicates whether the request is to get a system-level
  // ConfigMap instead of a project-level or shared one.
  bool system_level = 4;
  // project is the name of the project in which to get the ConfigMap. If empty
  // and system_level is false, gets a shared ConfigMap. This value is ignored
  // if system_level is true.
  string project = 1;
  // name is the name of the ConfigMap to retrieve.
  string name = 2;
  // format specifies the desired response format (structured object or raw
  // YAML).
  RawFormat format = 3;
}

// GetConfigMapResponse contains the requested ConfigMap.
message GetConfigMapResponse {
  oneof result {
    // config_map is the structured Kubernetes ConfigMap object.
    k8s.io.api.core.v1.ConfigMap config_map = 1;
    // raw is the raw YAML representation of the ConfigMap.
    bytes raw = 2;
  }
}

// UpdateConfigMapRequest is the request for updating a project-level,
// system-level, or shared ConfigMap.
message UpdateConfigMapRequest {
  // system_level indicates whether the request is to update a system-level
  // ConfigMap instead of a project-level or shared one.
  bool system_level = 1;
  // project is the name of the project containing the ConfigMap to be updated.
  // If empty and system_level is false, updates the ConfigMap in the shared
  // resources namespace. This value is ignored if system_level is true.
  string project = 2;
  // name is the name of the ConfigMap to be updated.
  string name = 3;
  // description is a human-readable description of the ConfigMap.
  string description = 4;
  // data contains the key-value pairs that make up the ConfigMap.
  map<string, string> data = 5;
}

// UpdateConfigMapResponse is the response containing the updated ConfigMap.
message UpdateConfigMapResponse {
  // config_map is the updated ConfigMap.
  k8s.io.api.core.v1.ConfigMap config_map = 1;
}

/* Repo Credentials Messages */

// CreateRepoCredentialsRequest is the request for creating new credentials for accessing external repositories.
message CreateRepoCredentialsRequest {
  // project is the name of the project where the credentials will be stored.
  string project = 1;
  // name is the name of the credentials.
  string name = 2;
  // description is a human-readable description of the credentials.
  string description = 8;
  // type specifies the credential type (git, helm, image).
  string type = 3;
  // repo_url is the URL of the repository or registry these credentials apply to.
  string repo_url = 4 [json_name = "repoURL"];
  // repo_url_is_regex indicates whether repo_url should be treated as a regular expression.
  bool repo_url_is_regex = 5 [json_name = "repoURLIsRegex"];
  // username is the username for authentication.
  string username = 6;
  // password is the password or token for authentication.
  string password = 7;
}

// CreateRepoCredentialsResponse contains the newly created repository credentials.
message CreateRepoCredentialsResponse {
  // credentials is the created Kubernetes Secret containing the credentials.
  k8s.io.api.core.v1.Secret credentials = 1;
}

// DeleteRepoCredentialsRequest is the request for deleting existing repository credentials.
message DeleteRepoCredentialsRequest {
  // project is the name of the project containing the credentials.
  // If project is left empty, it will default to the "shared resources" namespace.
  string project = 1;
  // name is the name of the credentials to delete.
  string name = 2;
}

// DeleteRepoCredentialsResponse is the response returned after deleting repository credentials.
message DeleteRepoCredentialsResponse {
  /* explicitly empty */
}

// GetRepoCredentialsRequest is the request for retrieving existing repository credentials.
message GetRepoCredentialsRequest {
  // project is the name of the project containing the credentials.
  string project = 1;
  // name is the name of the credentials to retrieve.
  string name = 2;
  // format specifies the desired response format (structured object or raw YAML).
  RawFormat format = 3;
}

// GetRepoCredentialsResponse contains the requested repository credentials information.
message GetRepoCredentialsResponse {
  oneof result {
    // credentials is the structured Kubernetes Secret containing the credentials.
    k8s.io.api.core.v1.Secret credentials = 1;
    // raw is the raw YAML representation of the credentials.
    bytes raw = 2;
  }
}

// ListRepoCredentialsRequest is the request for listing all repository credentials in a project.
message ListRepoCredentialsRequest {
  // project is the name of the project whose credentials will be listed.
  string project = 1;
}

// ListRepoCredentialsResponse contains a list of repository credentials for the specified project.
message ListRepoCredentialsResponse {
  // credentials is the list of Kubernetes Secrets containing the credentials.
  repeated k8s.io.api.core.v1.Secret credentials = 1;
}

// UpdateRepoCredentialsRequest is the request for updating existing repository credentials.
message UpdateRepoCredentialsRequest {
  // project is the name of the project containing the credentials.
  string project = 1;
  // name is the name of the credentials to update.
  string name = 2;
  // description is a human-readable description of the credentials.
  string description = 8;
  // type specifies the credential type (git, helm, image).
  string type = 3;
  // repo_url is the URL of the repository or registry these credentials apply to.
  string repo_url = 4 [json_name = "repoURL"];
  // repo_url_is_regex indicates whether repo_url should be treated as a regular expression.
  bool repo_url_is_regex = 5 [json_name = "repoURLIsRegex"];
  // username is the username for authentication.
  string username = 6;
  // password is the password or token for authentication.
  string password = 7;
}

// UpdateRepoCredentialsResponse contains the updated repository credentials information.
message UpdateRepoCredentialsResponse {
  // credentials is the updated Kubernetes Secret containing the credentials.
  k8s.io.api.core.v1.Secret credentials = 1;
}

/* Generic Credentials Messages */

// ListGenericCredentialsRequest is the request for listing all generic
// credentials in a project, shared namespace, or system namespace.
message ListGenericCredentialsRequest {
  // system_level indicates whether the request is to list generic credentials
  // from the system-level namespace instead of a project-level or shared namespace.
  bool system_level = 2;
  // project is the name of the project whose generic credentials will be listed.
  // If empty and system_level is false, lists generic credentials from the shared resources namespace.
  // This value is ignored if system_level is true.
  string project = 1;
}

// ListGenericCredentialsResponse contains a list of generic credentials for the specified project.
message ListGenericCredentialsResponse {
  // credentials is the list of Kubernetes Secrets containing generic credentials within the project.
  repeated k8s.io.api.core.v1.Secret credentials = 1;
}

// CreateGenericCredentialsRequest is the request for creating new generic
// credentials within a project, shared namespace, or system namespace.
message CreateGenericCredentialsRequest {
  // system_level indicates whether the request is to create generic credentials
  // in the system-level namespace instead of a project-level or shared namespace.
  bool system_level = 6;
  // project is the name of the project where the generic credentials will be
  // created. If empty and system_level is false, creates generic credentials in the shared resources
  // namespace. This value is ignored if system_level is true.
  string project = 1;
  // name is the name of the generic credentials to create.
  string name = 2;
  // description is a human-readable description of the generic credentials.
  string description = 3;
  // data contains the key-value pairs that make up the generic credentials data.
  map<string, string> data = 4;
}

// CreateGenericCredentialsResponse contains the newly created generic credentials.
message CreateGenericCredentialsResponse {
  // credentials is the created Kubernetes Secret containing generic credentials within the project.
  k8s.io.api.core.v1.Secret credentials = 1;
}

// UpdateGenericCredentialsRequest is the request for updating existing generic credentials.
message UpdateGenericCredentialsRequest {
  // system_level indicates whether the request is to update generic credentials
  // in the system-level namespace instead of a project-level or shared namespace.
  bool system_level = 6;
  // project is the name of the project containing the generic credentials. If
  // empty and system_level is false, updates generic credentials in the shared resources namespace.
  // This value is ignored if system_level is true.
  string project = 1;
  // name is the name of the generic credentials to update.
  string name = 2;
  // description is a human-readable description of the generic credentials.
  string description = 3;
  // data contains the key-value pairs that make up the generic credentials data.
  map<string, string> data = 4;
}

// UpdateGenericCredentialsResponse contains the updated generic credentials information.
message UpdateGenericCredentialsResponse {
  // credentials is the updated Kubernetes Secret containing generic credentials within the project.
  k8s.io.api.core.v1.Secret credentials = 1;
}

// DeleteGenericCredentialsRequest is the request for deleting generic
// credentials.
message DeleteGenericCredentialsRequest {
  // system_level indicates whether the request is to delete generic credentials
  // from the system-level namespace instead of a project-level or shared namespace.
  bool system_level = 3;
  // project is the name of the project containing the generic credentials. If
  // empty and system_level is false, deletes generic credentials from the shared resources namespace.
  // This value is ignored if system_level is true.
  string project = 1;
  // name is the name of the generic credentials to delete.
  string name = 2;
}

// DeleteGenericCredentialsResponse is the response returned after deleting generic credentials.
message DeleteGenericCredentialsResponse {
  /* explicitly empty */
}

/* Analysis Messages */

// ListAnalysisTemplatesRequest is the request for listing all analysis templates in a project.
message ListAnalysisTemplatesRequest {
  // project is the name of the project whose analysis templates will be listed.
  string project = 1;
}

// ListAnalysisTemplatesResponse contains a list of analysis templates for the specified project.
message ListAnalysisTemplatesResponse {
  // analysis_templates is the list of AnalysisTemplate resources within the project.
  repeated github.com.akuity.kargo.api.stubs.rollouts.v1alpha1.AnalysisTemplate analysis_templates = 1 [json_name = "analysisTemplates"];
}

// GetAnalysisTemplateRequest is the request for retrieving a specific analysis template.
message GetAnalysisTemplateRequest {
  // project is the name of the project containing the analysis template.
  string project = 1;
  // name is the name of the analysis template to retrieve.
  string name = 2;
  // format specifies the desired response format (structured object or raw YAML).
  RawFormat format = 3;
}

// GetAnalysisTemplateResponse contains the requested analysis template information.
message GetAnalysisTemplateResponse {
  oneof result {
    // analysis_template is the structured AnalysisTemplate resource.
    github.com.akuity.kargo.api.stubs.rollouts.v1alpha1.AnalysisTemplate analysis_template = 1 [json_name = "analysisTemplate"];
    // raw is the raw YAML representation of the analysis template.
    bytes raw = 2;
  }
}

// DeleteAnalysisTemplateRequest is the request for deleting an analysis template.
message DeleteAnalysisTemplateRequest {
  // project is the name of the project containing the analysis template.
  string project = 1;
  // name is the name of the analysis template to delete.
  string name = 2;
}

// DeleteAnalysisTemplateResponse is the response returned after deleting an analysis template.
message DeleteAnalysisTemplateResponse {
  /* explicitly empty */
}

// ListClusterAnalysisTemplatesRequest is the request for listing all cluster-level analysis templates.
message ListClusterAnalysisTemplatesRequest {}

// ListClusterAnalysisTemplatesResponse contains a list of cluster-level analysis templates.
message ListClusterAnalysisTemplatesResponse {
  // cluster_analysis_templates is the list of ClusterAnalysisTemplate resources.
  repeated github.com.akuity.kargo.api.stubs.rollouts.v1alpha1.ClusterAnalysisTemplate cluster_analysis_templates = 1 [json_name = "clusteranalysisTemplates"];
}

// GetClusterAnalysisTemplateRequest is the request for retrieving a specific cluster analysis template.
message GetClusterAnalysisTemplateRequest {
  // name is the name of the cluster analysis template to retrieve.
  string name = 2;
  // format specifies the desired response format (structured object or raw YAML).
  RawFormat format = 3;
}

// GetClusterAnalysisTemplateResponse contains the requested cluster analysis template information.
message GetClusterAnalysisTemplateResponse {
  oneof result {
    // cluster_analysis_template is the structured ClusterAnalysisTemplate resource.
    github.com.akuity.kargo.api.stubs.rollouts.v1alpha1.ClusterAnalysisTemplate cluster_analysis_template = 1 [json_name = "clusterAnalysisTemplate"];
    // raw is the raw YAML representation of the cluster analysis template.
    bytes raw = 2;
  }
}

// DeleteClusterAnalysisTemplateRequest is the request for deleting a cluster analysis template.
message DeleteClusterAnalysisTemplateRequest {
  // name is the name of the cluster analysis template to delete.
  string name = 2;
}

// DeleteClusterAnalysisTemplateResponse is the response returned after deleting a cluster analysis template.
message DeleteClusterAnalysisTemplateResponse {
  /* explicitly empty */
}

// GetAnalysisRunRequest is the request for retrieving a specific analysis run.
message GetAnalysisRunRequest {
  // namespace is the namespace containing the analysis run.
  string namespace = 1;
  // name is the name of the analysis run to retrieve.
  string name = 2;
  // format specifies the desired response format (structured object or raw YAML).
  RawFormat format = 3;
}

// GetAnalysisRunResponse contains the requested analysis run information.
message GetAnalysisRunResponse {
  oneof result {
    // analysis_run is the structured AnalysisRun resource.
    github.com.akuity.kargo.api.stubs.rollouts.v1alpha1.AnalysisRun analysis_run = 1 [json_name = "analysisRun"];
    // raw is the raw YAML representation of the analysis run.
    bytes raw = 2;
  }
}

// GetAnalysisRunLogsRequest is the request for retrieving logs from an analysis run.
message GetAnalysisRunLogsRequest {
  // namespace is the namespace containing the analysis run.
  string namespace = 1;
  // name is the name of the analysis run whose logs to retrieve.
  string name = 2;
  // metric_name is the specific metric whose logs to retrieve.
  string metric_name = 3;
  // container_name is the specific container whose logs to retrieve.
  string container_name = 4;
}

// GetAnalysisRunLogsResponse contains a chunk of logs from the analysis run.
message GetAnalysisRunLogsResponse {
  // chunk is a portion of the log output from the analysis run.
  string chunk = 1;
}

/* Event Messages */

// ListProjectEventsRequest is the request for listing events in a project.
message ListProjectEventsRequest {
  // project is the name of the project whose events will be listed.
  string project = 1;
}

// ListProjectEventsResponse contains a list of events for the specified project.
message ListProjectEventsResponse {
  // events is the list of Kubernetes Events within the project.
  repeated k8s.io.api.core.v1.Event events = 1;
}

/* Promotion Task Messages */

// ListPromotionTasksRequest is the request for listing promotion tasks in a project.
message ListPromotionTasksRequest {
  // project is the name of the project whose promotion tasks will be listed.
  string project = 1;
}

// ListPromotionTasksResponse contains a list of promotion tasks for the specified project.
message ListPromotionTasksResponse {
  // promotion_tasks is the list of PromotionTask resources within the project.
  repeated github.com.akuity.kargo.api.v1alpha1.PromotionTask promotion_tasks = 1;
}

// GetPromotionTaskRequest is the request for retrieving a specific promotion task.
message GetPromotionTaskRequest {
  // project is the name of the project containing the promotion task.
  string project = 1;
  // name is the name of the promotion task to retrieve.
  string name = 2;
  // format specifies the desired response format (structured object or raw YAML).
  RawFormat format = 3;
}

// GetPromotionTaskResponse contains the requested promotion task information.
message GetPromotionTaskResponse {
  oneof result {
    // promotion_task is the structured PromotionTask resource.
    github.com.akuity.kargo.api.v1alpha1.PromotionTask promotion_task = 1 [json_name = "promotionTask"];
    // raw is the raw YAML representation of the promotion task.
    bytes raw = 2;
  }
}

// ListClusterPromotionTasksRequest is the request for listing all cluster-level promotion tasks.
message ListClusterPromotionTasksRequest {}

// ListClusterPromotionTasksResponse contains a list of cluster-level promotion tasks.
message ListClusterPromotionTasksResponse {
  // cluster_promotion_tasks is the list of ClusterPromotionTask resources.
  repeated github.com.akuity.kargo.api.v1alpha1.ClusterPromotionTask cluster_promotion_tasks = 1;
}

// GetClusterPromotionTaskRequest is the request for retrieving a specific cluster promotion task.
message GetClusterPromotionTaskRequest {
  // name is the name of the cluster promotion task to retrieve.
  string name = 2;
  // format specifies the desired response format (structured object or raw YAML).
  RawFormat format = 3;
}

// GetClusterPromotionTaskResponse contains the requested cluster promotion task information.
message GetClusterPromotionTaskResponse {
  oneof result {
    // promotion_task is the structured ClusterPromotionTask resource.
    github.com.akuity.kargo.api.v1alpha1.ClusterPromotionTask promotion_task = 1 [json_name = "clusterPromotionTask"];
    // raw is the raw YAML representation of the cluster promotion task.
    bytes raw = 2;
  }
}

/* Kargo Role Messages */

// CreateRoleRequest is a request to create a new Kargo Role virtual resource by
// creating its underlying Kubernetes resources.
message CreateRoleRequest {
  // role is the Kargo Role virtual resource to create.
  github.com.akuity.kargo.api.rbac.v1alpha1.Role role = 1;
}

// CreateRoleResponse contains the details of a newly created Kargo Role virtual
// resource.
message CreateRoleResponse {
  // role is the newly created Kargo Role virtual resource.
  github.com.akuity.kargo.api.rbac.v1alpha1.Role role = 1;
}

// DeleteRoleRequest is a request to delete a Kargo Role virtual resource by
// deleting its underlying Kubernetes resources.
message DeleteRoleRequest {
  // project is the name of the project containing the Kargo Role to be deleted.
  string project = 1;
  // name is the name of the Kargo Role to deleted.
  string name = 2;
}

// DeleteRoleResponse is the response returned after deleting a Kargo Role
// virtual resource.
message DeleteRoleResponse {
  /* explicitly empty */
}

// GetRoleRequest is a request to retrieve the details of a Kargo Role virtual
// resource or its underlying Kubernetes resources.
message GetRoleRequest {
  // system_level indicates whether the request is to retrieve a system-level
  // role instead of a project-level one.
  bool system_level = 5;
  // project is the name of the project containing the Kargo Role to be
  // retrieved.
  string project = 1;
  // name is the name of the Kargo Role to retrieve.
  string name = 2;
  // as_resources indicates whether to return the Kargo Role's underlying
  // Kubernetes resources instead of the Kargo Role virtual resource.
  bool as_resources = 3;
  // format specifies the desired response format (structured object or raw
  // YAML or JSON).
  RawFormat format = 4;
}

// GetRoleResponse contains the details of a Kargo Role virtual resource or its
// underlying Kubernetes resources.
message GetRoleResponse {
  oneof result {
    // role is a structured Kargo Role virtual resource.
    github.com.akuity.kargo.api.rbac.v1alpha1.Role role = 1;
    // resources is a structured RoleResources object encapsulating the Kargo
    // Role's underlying Kubernetes resources.
    github.com.akuity.kargo.api.rbac.v1alpha1.RoleResources resources = 2;
    // raw is a raw YAML or JSON representation of the requested resource(s).
    bytes raw = 3;
  }
}

// Claims represents a collection of OIDC claims.
message Claims {
  // Note: oneof and repeated do not work together
  // claims is a list of OIDC claims.
  repeated github.com.akuity.kargo.api.rbac.v1alpha1.Claim claims = 1;
}

// GrantRequest is a request to assign permissions to a Kargo Role virtual
// resource or to bind users having specific ODIC claims to a Kargo Role virtual
// resource.
message GrantRequest {
  // project is the name of the project containing the Kargo Role that is the
  // subject of the grant.
  string project = 1;
  // role is the name of the Kargo Role that is the subject of the grant.
  string role = 2;
  oneof request {
    // user_claims are OIDC claims to which the Kargo Role should be mapped.
    Claims user_claims = 3;
    // resource_details are the details of permissions to be granted to the
    // Kargo Role.
    github.com.akuity.kargo.api.rbac.v1alpha1.ResourceDetails resource_details = 4;
  }
}

// GrantResponse contains the details of a Kargo Role virtual resource after a
// new grant.
message GrantResponse {
  // role is the Kargo Role that was the subject of the grant.
  github.com.akuity.kargo.api.rbac.v1alpha1.Role role = 1;
}

// ListRolesRequests is a request to retrieve the details of all Kargo Role
// virtual resources or their underlying Kubernetes resources.
message ListRolesRequest {
  // system_level indicates whether the request is to list system-level roles
  // instead of project-level roles.
  bool system_level = 3;
  // project is the name of the project for which to list all Kargo Roles.
  string project = 1;
  // as_resources indicates whether to return each Kargo Role's underlying
  // Kubernetes resources instead of the Kargo Role virtual resource(s).
  bool as_resources = 2;
}

// ListRolesResponse contains a list of Kargo Role virtual resources or their
// underlying Kubernetes resources.
message ListRolesResponse {
  // Note: oneof and repeated do not work together
  // roles is a list of Kargo Role virtual resources.
  repeated github.com.akuity.kargo.api.rbac.v1alpha1.Role roles = 1;
  // resources is a list of RoleResource objects encapsulating the Kargo Roles'
  // underlying Kubernetes resources.
  repeated github.com.akuity.kargo.api.rbac.v1alpha1.RoleResources resources = 2;
}

// RevokeRequest is a request to remove permissions from a Kargo Role virtual
// resource or to unbind users having specific OIDC claims from a Kargo Role
// virtual resource.
message RevokeRequest {
  // project is the name of the project containing the Kargo Role that is the
  // subject of the revocation.
  string project = 1;
  // role is the name of the Kargo Role that is the subject of the revocation.
  string role = 2;
  oneof request {
    // user_claims are OIDC claims from which the Kargo Role virtual resource
    // will be unmapped.
    Claims user_claims = 3;
    // resource_details are the details of permissions to be revoked from the
    // Kargo Role.
    github.com.akuity.kargo.api.rbac.v1alpha1.ResourceDetails resource_details = 4;
  }
}

// RevokeResponse contains the details of a Kargo Role virtual resource after a
// revocation.
message RevokeResponse {
  // role is the Kargo Role virtual resource that was the subject of the
  // revocation.
  github.com.akuity.kargo.api.rbac.v1alpha1.Role role = 1;
}

// UpdateRoleRequest is a request to modify an existing Kargo Role virtual
// resource by updating its underlying Kubernetes resources.
message UpdateRoleRequest {
  // role is the Kargo Role virtual resource to update.
  github.com.akuity.kargo.api.rbac.v1alpha1.Role role = 1;
}

// UpdateRoleResponse contains the details of the updated Kargo Role virtual
// resource.
message UpdateRoleResponse {
  // role is the updated Kargo Role virtual resource.
  github.com.akuity.kargo.api.rbac.v1alpha1.Role role = 1;
}

/* Kargo API Token Messages */

// CreateAPITokenRequest is a request to generate a new bearer token associated
// with a specified Kargo Role virtual resource.
message CreateAPITokenRequest {
  // system_level indicates whether the request is to create a token associated
  // with a system-level Kargo Role virtual resource instead of one at the
  // project-level.
  bool system_level = 1;
  // project is the name of the project containing the Kargo Role virtual
  // resource for which a new token is being created. This value is ignored if
  // system_level is true.
  string project = 2;
  // role_name is the name of the Kargo Role virtual resource for which to
  // generate a new bearer token.
  string role_name = 3;
  // name is the name for the bearer token to be created.
  string name = 4;
}

// CreateAPITokenResponse contains a newly generated bearer token in the form of
// a Kubernetes Secret.
message CreateAPITokenResponse {
  // token_secret is a Kubernetes Secret containing the token.
  k8s.io.api.core.v1.Secret token_secret = 1;
}

// DeleteAPITokenRequest is a request to delete a bearer token associated with a
// Kargo Role virtual resource.
message DeleteAPITokenRequest {
  // system_level indicates whether the request is to delete a token associated
  // with a system-level Kargo Role virtual resource instead of one at the
  // project-level.
  bool system_level = 1;
  // project is the name of the project containing the token that is to be
  // deleted. This value is ignored if system_level is true.
  string project = 2;
  // name is the name of the token to delete.
  string name = 3;
}

// DeleteAPITokenResponse is the response returned after deleting a bearer token
// associated with a Kargo Role virtual resource.
message DeleteAPITokenResponse {
  /* explicitly empty */
}

// GetAPITokenRequest is a request to retrieve details of a bearer token
// associated with a Kargo Role virtual resource.
message GetAPITokenRequest {
  // system_level indicates whether the request is for a token associated with a
  // system-level Kargo Role virtual resource instead of one at the
  // project-level.
  bool system_level = 1;
  // project is the name of the project containing the requested token. This
  // value is ignored if system_level is true.
  string project = 2;
  // name is the name of the token to retrieve.
  string name = 3;
  // format specifies the format for raw resource representation.
  RawFormat format = 4;
}

// GetAPITokenResponse contains contains the details of a bearer token
// associated with a Kargo Role virtual resource.
message GetAPITokenResponse {
  oneof result {
    // token_secret is a Kubernetes Secrets containing a redacted token
    // associated with a Kargo Role virtual resource.
    k8s.io.api.core.v1.Secret token_secret = 1;
    // raw is a raw YAML or JSON representation of the requested resource.
    bytes raw = 2;
  }
}

// ListAPITokensRequest is a request to list bearer tokens associated with a
// specified Kargo Role virtual resource.
message ListAPITokensRequest {
  // system_level indicates whether to list tokens associated with system-level
  // Kargo Role virtual resources instead of ones at the project-level.
  bool system_level = 1;
  // project is the name of the project containing the tokens.
  string project = 2;
  // role_name is the name of the Kargo Role virtual resource for which to list
  // associated tokens.
  string role_name = 3;
}

// ListAPITokensResponse contains a list of bearer tokens associated with a
// specified Kargo Role virtual resource.
message ListAPITokensResponse {
  // token_secrets is the list of Kubernetes Secrets containing redacted tokens
  // associated with a Kargo Role virtual resource.
  repeated k8s.io.api.core.v1.Secret token_secrets = 1;
}

message RefreshResourceRequest {
  // project is the name of the project containing the object to refresh.
  // leave blank if refreshing a cluster-config.
  string project = 1;
  // name is the name of the object to refresh.
  // leave blank if refreshing a project or cluster config.
  string name = 2;
  // resource_type is the kind of resource to refresh.
  // should be one of: ProjectConfig, ClusterConfig, Warehouse, or Stage.
  string resource_type = 3;
}

message RefreshResourceResponse {
  google.protobuf.Any resource = 1;
}
